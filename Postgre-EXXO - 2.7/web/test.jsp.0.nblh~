<%@page contentType="text/html" pageEncoding="UTF-8"%>
<jsp:useBean id="SLOGAN" class="BEANS.SLOGAN" scope="application"/><jsp:useBean id="OP" class="BEANS.OperationCard" scope="page"/><%
String user=(String)session.getAttribute("id");
String role=(String)session.getAttribute("role");
String id=request.getParameter("id");
OP.setId(id, user, role);

String name=OP.name;
String owner=OP.owner;
String fio=OP.fio;
String position=OP.position;
String unit=OP.unit;
String classLate=OP.classLate;
String STATUS=OP.STATUS;
String nextTime=OP.nextTime;
String buttons=OP.buttons;
String TimeEnter=OP.TimeEnter;
String text=OP.text;
String why=OP.why;
String WHY=OP.WHY;
String comment=OP.comment;
Boolean R=OP.R;
Boolean DoneIsDone=OP.DoneIsDone;
String customer=OP.customer;
boolean decide=OP.decide;
boolean answer=OP.answer;
int status=OP.status;

if(R) response.sendRedirect("notPermited.html");
String slogan=SLOGAN.getSlogan();
%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Операция <%=id %></title><meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="content-style-type" content="text/css"><link rel="stylesheet" href="alloy/build/aui-skins/core/css/main.css" type="text/css" >
<link rel="stylesheet" href="alloy/build/aui-skins/classic/css/custom.css" type="text/css" >
<link rel="stylesheet" href="alloy/build/aui-skins/core/css/form.css" type="text/css" >
<script type="text/javascript" charset="utf-8" src="alloy/build/yui/yui-min.js"></script>
<script type="text/javascript" charset="utf-8" src="alloy/build/aui-base/aui-base-debug.js"></script>
<link rel="stylesheet" href="index.css" type="text/css" /><link rel="stylesheet" href="blue.css" type="text/css" />
<style type="text/css" >
.table {width: 50%;margin:10px;background-color: white;height: auto;}
label {font-weight: bolder;font-size:10pt;}
.table td.left {text-align:right;padding:10px;padding-right:20px;width: 150px;}
.table td.right {text-align:left;padding-bottom: 10px;padding-top: 10px;}
.table tr {border-bottom: 1px solid #dfdfdf;}
#img{width:110px;height:147px;background-color:gray;margin:3px;float: right;}
#img img {width:110px;height:147px;}
.maininfo{font-size: 11pt;}
#birthday {font-size: 10pt;}
#submenu {font-size: 9pt;margin-top: 5px;}
#submenu a {text-decoration: none;margin-right: 10px;}
td.right .fio {margin-top: 10px;}
td.right .fio a {text-decoration: none;}
td.right .blue {color: black;font-size: 8pt;}
td.right .insp {text-align: right;margin-top: 8px;padding: 10px;}
td.right .desc {padding-right: 10px;padding-top: 10px;}
td.right .insp a {font-size: 8pt;}
#pool {background-color: white;padding: 10px;position: absolute;top: 100px;left: 300px;z-index: 9999999;display: none;}
#close,#closer{color:red;width:100%;text-align:right;}
#jornal {background-color: white;margin: 10px;width: 50%;padding: 10px;}
.late {color: red;}
#decision{margin-top: 10px;}
#ans {background-color: #f6e4b2;margin: 10px;width: 50%;padding: 10px;}
#ans div {font-size: 12pt;}
#start {height: 30px;}
</style>
</head><body><div id="content-wrapper">
<div id="header"><table id="tableH"><tbody><tr><td id="tdlogo"><img src="LOGO" id="logo"></td><td><div id="head">
<table><tbody><tr><td id="slogan" valign="center"><%= slogan %></td><td><jsp:include page="poisk" flush="true" />
</td></tr></tbody></table></div><div id="foot"><jsp:include page="topMenu" flush="true" /></div></td></tr></tbody></table></div>
<table id="grid" class="grid"><tbody id="atbody"><tr id="tr"><td id="menu-td" class="menu-td" valign="top"><div class="menu" id="menu"></div></td>
<td id="column-3" valign="top"><table class="table"><tbody><tr><td class="left"><div id="img"><img src="IMG?id=<%=customer %>" ></div></td>
<td class="right"><div class="maininfo"><strong><%=name %></strong></div>
<div class="maininfo fio"><a href="empCard.jsp?id=<%=customer %>"><%=fio %></a></div>
<div class="maininfo blue"><%=position %></div>
<div class="maininfo blue" > <%=unit %> </div>
<div class="maininfo<%=classLate%>" > <%=STATUS %> </div>
<div class="maininfo<%=classLate%>" > <%=nextTime %> </div>
<div class="maininfo" id="start"><%=buttons%></div>
</td></tr></tbody></table>
<div id="jornal" ><div><%= TimeEnter %></div><%=text %> </div>
<%if (why!=null&&!why.equals("")){ out.print("<div id='ans'><div>"+WHY+"</div>"+why+"</div>");}%>
<%if (comment!=null&&!comment.equals("")) { out.print("<div id='ans'><div>Оценка выполнения:</div>"+comment+"</div>");}%>
</td></tr> </tbody></table></div>
<div id="menus" class="aui-menu"><jsp:include page="menu.jsp" flush="true" /></div>
<div id="pool"><div id="close"><span>ЗАКРЫТЬ</span></div>
<form action="decision" method="POST">
<input type="hidden" name="id" value="<%= id %>">
<input type="hidden" name="res" value="<% if(answer) {out.print("5");} else {out.print("3");} %>">
<label id="why"><%= WHY %></label><br>
<textarea cols="50" rows="10" name="text"></textarea><br>
<input type="submit" value="отправить"></form></div>
<script  type="text/javascript">
AUI().ready('aui-node-fx','aui-overlay-mask', 'node-menunav', 'aui-button','aui-toolbar', function(A){
var overlayMask = new A.OverlayMask().render();
A.one('#pool').setStyle('opacity','0');
function negative(){overlayMask.set('target', document).show();A.one('#pool').fadeIn('Normal');A.one('#pool').setStyle('display','block');}
A.one('#close span').on('click',function(event){closer(A.one('#pool'));});
function closer(node){node.setStyle('display','none');node.setStyle('opacity','0');overlayMask.hide();}
<%if(decide&&owner.equals(user)){ %>
new A.Toolbar({activeState: true,children: [
{label: 'Да', icon: 'plus',handler: {fn: function(e){location="decision?res=2&id=<%=id %>"}}},
{label: 'Нет', icon: 'minus',handler: {fn: function(e){negative()}}}]}).render(A.one('#decision'));
<%} else if(answer&&status==1&&owner.equals(user)){%>
new A.Button({icon: 'check',label:'Ответить',handler: {fn: function(e){
overlayMask.set('target', document).show();
A.one('#pool').fadeIn('Normal');
A.one('#pool').setStyle('display','block');}}}).render(A.one("#start"));
<%} else if(DoneIsDone&&owner.equals(user)){%>
new A.Button({icon: 'check',label:'Закрыть вопрос',handler: {fn: function(e){location="decision?res=4&id=<%=id %>";}}}).render(A.one("#start"));
<%} %>
A.one(".aui-overlaymask-content").setStyle("height","100%");
<jsp:include page="menuPoisk" flush="true" />
});
</script>
</body></html>